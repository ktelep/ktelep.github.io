<!doctype html>
<html lang="en-US">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <meta name="generator" content="VuePress 2.0.0-rc.18" />
    <style>
      :root {
        --vp-c-bg: #fff;
      }

      [data-theme='dark'] {
        --vp-c-bg: #1b1b1f;
      }

      html,
      body {
        background-color: var(--vp-c-bg);
      }
    </style>
    <script>
      const userMode = localStorage.getItem('vuepress-color-scheme')
      const systemDarkMode =
        'matchMedia' in window
          ? window.matchMedia('(prefers-color-scheme: dark)').matches
          : false

      if (userMode === 'light') {
        document.documentElement.dataset.theme = 'light'
      } else if (userMode === 'dark' || systemDarkMode) {
        document.documentElement.dataset.theme = 'dark'
      }
    </script>
    <title>Ansible | ktelep.github.io</title><meta name="description" content="Homepage of Kurt Telep">
    <link rel="preload" href="/assets/style-PoWje89h.css" as="style"><link rel="stylesheet" href="/assets/style-PoWje89h.css">
    <link rel="modulepreload" href="/assets/app-6qZbiVGh.js"><link rel="modulepreload" href="/assets/Ansible.html-BhNaDiSx.js">
    <link rel="prefetch" href="/assets/index.html-Dw5uNsX7.js" as="script"><link rel="prefetch" href="/assets/bootcamps.html-B-RgS2xt.js" as="script"><link rel="prefetch" href="/assets/get-started.html-coS475Ky.js" as="script"><link rel="prefetch" href="/assets/ntnxce.html-CxagtDMa.js" as="script"><link rel="prefetch" href="/assets/projects.html-7h8nms-c.js" as="script"><link rel="prefetch" href="/assets/Configuration.html-DkYK4mQd.js" as="script"><link rel="prefetch" href="/assets/Labprep.html-5c3wiNUO.js" as="script"><link rel="prefetch" href="/assets/index.html-BP8iHIaV.js" as="script"><link rel="prefetch" href="/assets/Terraform.html-C9X4IUxi.js" as="script"><link rel="prefetch" href="/assets/Configuration.html-Bryv0a-u.js" as="script"><link rel="prefetch" href="/assets/DataProtection.html-CUvPCskm.js" as="script"><link rel="prefetch" href="/assets/DeployingWorkloads.html-DEGG7KxH.js" as="script"><link rel="prefetch" href="/assets/Labprep.html-Ckpy0Qpu.js" as="script"><link rel="prefetch" href="/assets/ManagingWorkloads.html-tBZEb3Ul.js" as="script"><link rel="prefetch" href="/assets/index.html-CDafYv0p.js" as="script"><link rel="prefetch" href="/assets/404.html-lK_626jw.js" as="script"><link rel="prefetch" href="/assets/setupDevtools-7MC2TMWH-D_nNDbBg.js" as="script">
  </head>
  <body>
    <div id="app"><!--[--><div class="vp-theme-container external-link-icon" vp-container><!--[--><header class="vp-navbar" vp-navbar><div class="vp-toggle-sidebar-button" title="toggle sidebar" aria-expanded="false" role="button" tabindex="0"><div class="icon" aria-hidden="true"><span></span><span></span><span></span></div></div><span><a class="route-link" href="/"><!----><span class="vp-site-name" aria-hidden="true">ktelep.github.io</span></a></span><div class="vp-navbar-items-wrapper" style=""><!--[--><!--]--><nav class="vp-navbar-items vp-hide-mobile" aria-label="site navigation"><!--[--><div class="vp-navbar-item"><a class="route-link auto-link" href="/" aria-label="Home"><!---->Home<!----></a></div><div class="vp-navbar-item"><a class="route-link auto-link" href="/bootcamps.html" aria-label="Bootcamps"><!---->Bootcamps<!----></a></div><div class="vp-navbar-item"><a class="route-link auto-link" href="/ntnxce.html" aria-label="CE"><!---->CE<!----></a></div><!--]--></nav><!--[--><!--]--><button type="button" class="vp-toggle-color-mode-button" title="toggle color mode"><svg class="light-icon" viewbox="0 0 32 32" style=""><path d="M16 12.005a4 4 0 1 1-4 4a4.005 4.005 0 0 1 4-4m0-2a6 6 0 1 0 6 6a6 6 0 0 0-6-6z" fill="currentColor"></path><path d="M5.394 6.813l1.414-1.415l3.506 3.506L8.9 10.318z" fill="currentColor"></path><path d="M2 15.005h5v2H2z" fill="currentColor"></path><path d="M5.394 25.197L8.9 21.691l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 25.005h2v5h-2z" fill="currentColor"></path><path d="M21.687 23.106l1.414-1.415l3.506 3.506l-1.414 1.414z" fill="currentColor"></path><path d="M25 15.005h5v2h-5z" fill="currentColor"></path><path d="M21.687 8.904l3.506-3.506l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 2.005h2v5h-2z" fill="currentColor"></path></svg><svg class="dark-icon" viewbox="0 0 32 32" style="display:none;"><path d="M13.502 5.414a15.075 15.075 0 0 0 11.594 18.194a11.113 11.113 0 0 1-7.975 3.39c-.138 0-.278.005-.418 0a11.094 11.094 0 0 1-3.2-21.584M14.98 3a1.002 1.002 0 0 0-.175.016a13.096 13.096 0 0 0 1.825 25.981c.164.006.328 0 .49 0a13.072 13.072 0 0 0 10.703-5.555a1.01 1.01 0 0 0-.783-1.565A13.08 13.08 0 0 1 15.89 4.38A1.015 1.015 0 0 0 14.98 3z" fill="currentColor"></path></svg></button><!----></div></header><!--]--><div class="vp-sidebar-mask"></div><!--[--><aside class="vp-sidebar" vp-sidebar><nav class="vp-navbar-items" aria-label="site navigation"><!--[--><div class="vp-navbar-item"><a class="route-link auto-link" href="/" aria-label="Home"><!---->Home<!----></a></div><div class="vp-navbar-item"><a class="route-link auto-link" href="/bootcamps.html" aria-label="Bootcamps"><!---->Bootcamps<!----></a></div><div class="vp-navbar-item"><a class="route-link auto-link" href="/ntnxce.html" aria-label="CE"><!---->CE<!----></a></div><!--]--></nav><!--[--><!--]--><ul class="vp-sidebar-items"><!--[--><li><a class="route-link route-link-active auto-link vp-sidebar-item vp-sidebar-heading" href="/ansible_terra_ntnx_101/" aria-label="Ansible and Terraform 101 Bootcamp"><!---->Ansible and Terraform 101 Bootcamp<!----></a><!----></li><li><a class="route-link auto-link vp-sidebar-item vp-sidebar-heading" href="/ansible_terra_ntnx_101/Configuration.html" aria-label="Configuration"><!---->Configuration<!----></a><!----></li><li><a class="route-link auto-link vp-sidebar-item vp-sidebar-heading" href="/ansible_terra_ntnx_101/Terraform.html" aria-label="Terraform"><!---->Terraform<!----></a><!----></li><li><a class="route-link route-link-active auto-link vp-sidebar-item vp-sidebar-heading active" href="/ansible_terra_ntnx_101/Ansible.html" aria-label="Ansible"><!---->Ansible<!----></a><!----></li><li><a class="route-link auto-link vp-sidebar-item vp-sidebar-heading" href="/ansible_terra_ntnx_101/Labprep.html" aria-label="Lab Prep"><!---->Lab Prep<!----></a><!----></li><!--]--></ul><!--[--><!--]--></aside><!--]--><!--[--><main class="vp-page"><!--[--><!--]--><div class="theme-default-content" vp-content><!--[--><!--]--><div><h1 id="ansible" tabindex="-1"><a class="header-anchor" href="#ansible"><span>Ansible</span></a></h1><h2 id="ansible-overview" tabindex="-1"><a class="header-anchor" href="#ansible-overview"><span>Ansible Overview</span></a></h2><p>In this section, we will use Ansible to create a VM, make some modifications to that VM and then destroy that VM. Please be sure to follow along closely as we make changes. Note this is NOT a demonstration or deep dive into Ansible, but an overview showing how easy it is to integrate Ansible with Nutanix AHV.</p><h2 id="create-a-vm" tabindex="-1"><a class="header-anchor" href="#create-a-vm"><span>Create a VM</span></a></h2><ol><li><p>In your Admin VM, select the autolab/labs/ansible directory. This directory contains four ansible playbooks that we will be work with, one to create a vm, one to update a vm, one to delete a vm, and one to call a Nutanix Playbook via the Rest API</p></li><li><p>In your Terminal cd into the autolab/labs/ansible directory</p></li></ol><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre><code><span class="line"><span class="token builtin class-name">cd</span> ~/autolab/lab/ansible</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><ol start="3"><li><p>Update the create_vm.yml file. Providing the IP address for Prism Central, appropriate Username and Password. Also you will want to update the name of the VM to be deployed.</p><p><img src="/images/auto_ans_1.png" alt="Login Page"></p></li><li><p>In the terminal execute the playbook, be sure that you are in the autolab/lab/ansible directory. You will see the VM definition is created and the response output from the cluster.</p></li></ol><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre><code><span class="line">ansible-playbook create_vm.yml</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p><img src="/images/auto_ans_2.png" alt="Login Page"></p><p><img src="/images/auto_ans_3.png" alt="Login Page"></p><p>You can also confirm in Prism Central that the VM has been created. Note the number of vCPUs attached to this VM.</p><p><img src="/images/auto_ans_4.png" alt="Login Page"></p><h2 id="update-a-vm" tabindex="-1"><a class="header-anchor" href="#update-a-vm"><span>Update a VM</span></a></h2><p>Unlike Terraform, Ansible doesn&#39;t manage the &quot;state&quot; of the deployment and relies on inventory and live queries of the system to manage the environment. So when we make an Update we must define what we are actually updating. This also means you will often have Playbooks that define individual actions to be performed on groups of systems. In general Ansible is great for configuration management, whereas Terraform is better for infrastructure deployment. They are often used in tandem.</p><ol><li><p>Select the &quot;update_vm.yml&quot; playbook in your admin VM, and update it with the Prism Central information as we have done in the create_vm.yml file and also update the VM name to match the VM you created previously.</p><p><img src="/images/auto_ans_5.png" alt="Login Page"></p></li><li><p>In the terminal execute the playbook, you&#39;ll notice in the output that one of the steps is to identify the VM&#39;s uuid. This is the unique identifier that is used to make sure the change is made to the correct guest VM.</p></li></ol><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre><code><span class="line">ansible-playbook update_vm.yml</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p><img src="/images/auto_ans_6.png" alt="Login Page"></p><p>After the update is completed, look at the VM in Prism Central and you should see that the vCPUs have now increased to 8.</p><p><img src="/images/auto_ans_7.png" alt="Login Page"></p><h2 id="destroy-the-vm" tabindex="-1"><a class="header-anchor" href="#destroy-the-vm"><span>Destroy the VM</span></a></h2><ol><li><p>Who doesn&#39;t like some destruction! Select the &quot;delete_vm.yml&quot; playbook in your admin VM, and update it with the Prism Central information as we have done in the create_vm.yml file and also update the VM name to match the VM you created previously.</p><p><img src="/images/auto_ans_5.png" alt="Login Page"></p></li></ol><p>If you scroll down in this file, you&#39;ll find that there really is only one action near the end, and that is to define the VM as &#39;absent&#39; This tells Ansible that it should destroy the object.</p><ol start="2"><li>In the terminal execute the playbook, you&#39;ll notice in the output that one of the steps is to identify the VM&#39;s uuid. This is the unique identifier that is used to make sure the change is made to the correct guest VM. Removing a VM is effectively an &quot;update&quot; to the VM, just changing it&#39;s state.</li></ol><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre><code><span class="line">ansible-playbook delete_vm.yml</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>You should now see the VM no longer exists in Prism Central.</p></div><!--[--><!--]--></div><footer class="vp-page-meta"><!----><div class="vp-meta-item git-info"><div class="vp-meta-item last-updated"><span class="meta-item-label">Last Updated: </span><!----></div><div class="vp-meta-item contributors"><span class="meta-item-label">Contributors: </span><span class="meta-item-info"><!--[--><!--[--><span class="contributor" title="email: ktelep@gmail.com">Kurt Telep</span><!----><!--]--><!--]--></span></div></div></footer><nav class="vp-page-nav" aria-label="page navigation"><a class="route-link auto-link prev" href="/ansible_terra_ntnx_101/Terraform.html" aria-label="Terraform"><div class="hint"><span class="arrow left"></span> Prev</div><div class="link"><span>Terraform</span></div></a><a class="route-link auto-link next" href="/ansible_terra_ntnx_101/Labprep.html" aria-label="Lab Prep"><div class="hint">Next <span class="arrow right"></span></div><div class="link"><span>Lab Prep</span></div></a></nav><!--[--><!--]--></main><!--]--></div><!--[--><!----><!--]--><!--]--></div>
    <script type="module" src="/assets/app-6qZbiVGh.js" defer></script>
  </body>
</html>
