<!doctype html>
<html lang="en-US">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <meta name="generator" content="VuePress 2.0.0-rc.18" />
    <style>
      :root {
        --vp-c-bg: #fff;
      }

      [data-theme='dark'] {
        --vp-c-bg: #1b1b1f;
      }

      html,
      body {
        background-color: var(--vp-c-bg);
      }
    </style>
    <script>
      const userMode = localStorage.getItem('vuepress-color-scheme')
      const systemDarkMode =
        'matchMedia' in window
          ? window.matchMedia('(prefers-color-scheme: dark)').matches
          : false

      if (userMode === 'light') {
        document.documentElement.dataset.theme = 'light'
      } else if (userMode === 'dark' || systemDarkMode) {
        document.documentElement.dataset.theme = 'dark'
      }
    </script>
    <title>Terraform | ktelep.github.io</title><meta name="description" content="Homepage of Kurt Telep">
    <link rel="preload" href="/assets/style-PoWje89h.css" as="style"><link rel="stylesheet" href="/assets/style-PoWje89h.css">
    <link rel="modulepreload" href="/assets/app-6qZbiVGh.js"><link rel="modulepreload" href="/assets/Terraform.html-C9X4IUxi.js">
    <link rel="prefetch" href="/assets/index.html-Dw5uNsX7.js" as="script"><link rel="prefetch" href="/assets/bootcamps.html-B-RgS2xt.js" as="script"><link rel="prefetch" href="/assets/get-started.html-coS475Ky.js" as="script"><link rel="prefetch" href="/assets/ntnxce.html-CxagtDMa.js" as="script"><link rel="prefetch" href="/assets/projects.html-7h8nms-c.js" as="script"><link rel="prefetch" href="/assets/Ansible.html-BhNaDiSx.js" as="script"><link rel="prefetch" href="/assets/Configuration.html-DkYK4mQd.js" as="script"><link rel="prefetch" href="/assets/Labprep.html-5c3wiNUO.js" as="script"><link rel="prefetch" href="/assets/index.html-BP8iHIaV.js" as="script"><link rel="prefetch" href="/assets/Configuration.html-Bryv0a-u.js" as="script"><link rel="prefetch" href="/assets/DataProtection.html-CUvPCskm.js" as="script"><link rel="prefetch" href="/assets/DeployingWorkloads.html-DEGG7KxH.js" as="script"><link rel="prefetch" href="/assets/Labprep.html-Ckpy0Qpu.js" as="script"><link rel="prefetch" href="/assets/ManagingWorkloads.html-tBZEb3Ul.js" as="script"><link rel="prefetch" href="/assets/index.html-CDafYv0p.js" as="script"><link rel="prefetch" href="/assets/404.html-lK_626jw.js" as="script"><link rel="prefetch" href="/assets/setupDevtools-7MC2TMWH-D_nNDbBg.js" as="script">
  </head>
  <body>
    <div id="app"><!--[--><div class="vp-theme-container external-link-icon" vp-container><!--[--><header class="vp-navbar" vp-navbar><div class="vp-toggle-sidebar-button" title="toggle sidebar" aria-expanded="false" role="button" tabindex="0"><div class="icon" aria-hidden="true"><span></span><span></span><span></span></div></div><span><a class="route-link" href="/"><!----><span class="vp-site-name" aria-hidden="true">ktelep.github.io</span></a></span><div class="vp-navbar-items-wrapper" style=""><!--[--><!--]--><nav class="vp-navbar-items vp-hide-mobile" aria-label="site navigation"><!--[--><div class="vp-navbar-item"><a class="route-link auto-link" href="/" aria-label="Home"><!---->Home<!----></a></div><div class="vp-navbar-item"><a class="route-link auto-link" href="/bootcamps.html" aria-label="Bootcamps"><!---->Bootcamps<!----></a></div><div class="vp-navbar-item"><a class="route-link auto-link" href="/ntnxce.html" aria-label="CE"><!---->CE<!----></a></div><!--]--></nav><!--[--><!--]--><button type="button" class="vp-toggle-color-mode-button" title="toggle color mode"><svg class="light-icon" viewbox="0 0 32 32" style=""><path d="M16 12.005a4 4 0 1 1-4 4a4.005 4.005 0 0 1 4-4m0-2a6 6 0 1 0 6 6a6 6 0 0 0-6-6z" fill="currentColor"></path><path d="M5.394 6.813l1.414-1.415l3.506 3.506L8.9 10.318z" fill="currentColor"></path><path d="M2 15.005h5v2H2z" fill="currentColor"></path><path d="M5.394 25.197L8.9 21.691l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 25.005h2v5h-2z" fill="currentColor"></path><path d="M21.687 23.106l1.414-1.415l3.506 3.506l-1.414 1.414z" fill="currentColor"></path><path d="M25 15.005h5v2h-5z" fill="currentColor"></path><path d="M21.687 8.904l3.506-3.506l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 2.005h2v5h-2z" fill="currentColor"></path></svg><svg class="dark-icon" viewbox="0 0 32 32" style="display:none;"><path d="M13.502 5.414a15.075 15.075 0 0 0 11.594 18.194a11.113 11.113 0 0 1-7.975 3.39c-.138 0-.278.005-.418 0a11.094 11.094 0 0 1-3.2-21.584M14.98 3a1.002 1.002 0 0 0-.175.016a13.096 13.096 0 0 0 1.825 25.981c.164.006.328 0 .49 0a13.072 13.072 0 0 0 10.703-5.555a1.01 1.01 0 0 0-.783-1.565A13.08 13.08 0 0 1 15.89 4.38A1.015 1.015 0 0 0 14.98 3z" fill="currentColor"></path></svg></button><!----></div></header><!--]--><div class="vp-sidebar-mask"></div><!--[--><aside class="vp-sidebar" vp-sidebar><nav class="vp-navbar-items" aria-label="site navigation"><!--[--><div class="vp-navbar-item"><a class="route-link auto-link" href="/" aria-label="Home"><!---->Home<!----></a></div><div class="vp-navbar-item"><a class="route-link auto-link" href="/bootcamps.html" aria-label="Bootcamps"><!---->Bootcamps<!----></a></div><div class="vp-navbar-item"><a class="route-link auto-link" href="/ntnxce.html" aria-label="CE"><!---->CE<!----></a></div><!--]--></nav><!--[--><!--]--><ul class="vp-sidebar-items"><!--[--><li><a class="route-link route-link-active auto-link vp-sidebar-item vp-sidebar-heading" href="/ansible_terra_ntnx_101/" aria-label="Ansible and Terraform 101 Bootcamp"><!---->Ansible and Terraform 101 Bootcamp<!----></a><!----></li><li><a class="route-link auto-link vp-sidebar-item vp-sidebar-heading" href="/ansible_terra_ntnx_101/Configuration.html" aria-label="Configuration"><!---->Configuration<!----></a><!----></li><li><a class="route-link route-link-active auto-link vp-sidebar-item vp-sidebar-heading active" href="/ansible_terra_ntnx_101/Terraform.html" aria-label="Terraform"><!---->Terraform<!----></a><!----></li><li><a class="route-link auto-link vp-sidebar-item vp-sidebar-heading" href="/ansible_terra_ntnx_101/Ansible.html" aria-label="Ansible"><!---->Ansible<!----></a><!----></li><li><a class="route-link auto-link vp-sidebar-item vp-sidebar-heading" href="/ansible_terra_ntnx_101/Labprep.html" aria-label="Lab Prep"><!---->Lab Prep<!----></a><!----></li><!--]--></ul><!--[--><!--]--></aside><!--]--><!--[--><main class="vp-page"><!--[--><!--]--><div class="theme-default-content" vp-content><!--[--><!--]--><div><h1 id="terraform" tabindex="-1"><a class="header-anchor" href="#terraform"><span>Terraform</span></a></h1><h2 id="terraform-overview" tabindex="-1"><a class="header-anchor" href="#terraform-overview"><span>Terraform Overview</span></a></h2><p>In this section, we will use terraform to create a VM, make some modifications to that VM and then destroy that VM. Please be sure to follow along closely as we make changes. Note this is NOT a demonstration or deep dive into Terraform, but an overview showing how easy it is to integrate Terraform with Nutanix AHV.</p><h2 id="create-a-vm" tabindex="-1"><a class="header-anchor" href="#create-a-vm"><span>Create a VM</span></a></h2><ol><li><p>In your Admin VM, select the autolab/lab/terraform directory. This directory contains 3 files that make up our terraform configuration. main.tf is where the configuration steps are enumerated, terraform.tfvars stores our variables and variables.tf defines our variables.</p><p><img src="/images/auto_terra_1.png" alt="Login Page"></p></li><li><p>In your Terminal cd into the autolab/lab/terraform directory and initialize the terraform configuration. This will automatically download the appropriate modules.</p></li></ol><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre><code><span class="line"><span class="token builtin class-name">cd</span> ~/autolab/lab/ansible </span>
<span class="line">terraform init</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><p><img src="/images/auto_terra_3.png" alt="Login Page"></p><ol start="3"><li><p>Update the terraform.tfvars file, providing the PC IP address, username, and password, saving the file. Be sure to retain the double quotes around all values. There are much more secure ways of storing these secrets but for the sake of our lab we&#39;ve taken some shortcuts.</p><p><img src="/images/auto_terra_2.png" alt="Login Page"></p></li><li><p>Update the main.tf file, scrolling down until you find the VM name definition shown below. Update this to reflect YOUR user number.</p><p><img src="/images/auto_terra_4.png" alt="Login Page"></p></li><li><p>In the terminal, validate the terraform configuration. This will confirm that the config is syntactically valid, but may not catch all errors.</p></li></ol><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre><code><span class="line">terraform validate</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p><img src="/images/auto_terra_5.png" alt="Login Page"></p><ol start="6"><li>Now lets see what will happen when we run this Terraform configuration. You will see that many items in the plan are generated AFTER the VM is created, this is expected and Terraform maintains these items to make configuration changes in the future easier.</li></ol><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre><code><span class="line">terraform plan</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p><img src="/images/auto_terra_6.png" alt="Login Page"></p><ol start="7"><li>Finally lets apply the Terraform configuration to the cluster and create the VM.</li></ol><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre><code><span class="line">terraform apply</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p><img src="/images/auto_terra_7.png" alt="Login Page"></p><p><img src="/images/auto_terra_8.png" alt="Login Page"></p><p><img src="/images/auto_terra_9.png" alt="Login Page"></p><p>After the plan is shown to you again, you will be prompted to type &quot;yes&quot; to apply this plan. Go ahead and enter &quot;yes&quot; and hit enter. You can now confirm in Prism Central that your VM has been created.</p><p><img src="/images/auto_terra_10.png" alt="Login Page"></p><p>Note the number of vCPUs and Memory that are currently configured for the VM (2 vCPU, 1GB Memory)</p><h2 id="modify-a-vm" tabindex="-1"><a class="header-anchor" href="#modify-a-vm"><span>Modify a VM</span></a></h2><ol><li><p>Back in your admin VM, locate the num_vcpus_per_socket and memory_size_mib parameters in the main.tf file. Update them to reflect 4 vCPUs per socket and 2048 mib or memory as shown below. Be sure to save the file after making this change.</p><p><img src="/images/auto_terra_11.png" alt="Login Page"></p></li><li><p>Check what the terraform plan says will happen based on the configuration change we just made. Note how it is only modifying the VM&#39;s configuration, not deleting or rebuilding it.</p></li></ol><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre><code><span class="line">terraform plan</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p><img src="/images/auto_terra_12.png" alt="Login Page"></p><ol start="3"><li>Lets apply the Terraform configuration to the cluster and modify the VM. This may take a few seconds to apply.</li></ol><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre><code><span class="line">terraform apply</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p><img src="/images/auto_terra_13.png" alt="Login Page"></p><ol start="4"><li><p>Finally, go back and check the CPU and memory configuration as seen in Prism Central. Note how it now has 4 vCPU and 2GB of memory attached.</p><p><img src="/images/auto_terra_14.png" alt="Login Page"></p></li></ol><h2 id="removing-the-vm" tabindex="-1"><a class="header-anchor" href="#removing-the-vm"><span>Removing the VM</span></a></h2><p>Now that we&#39;re finished with our virtual machine, we can use terraform to remove it also.</p><ol><li>Execute the destroy command in the terminal to reclaim the VM and it&#39;s resources.</li></ol><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre><code><span class="line">terraform destroy</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p><img src="/images/auto_terra_15.png" alt="Login Page"></p><p><img src="/images/auto_terra_16.png" alt="Login Page"></p><ol start="2"><li>Confirm in Prism Central that the VM is no longer deployed.</li></ol></div><!--[--><!--]--></div><footer class="vp-page-meta"><!----><div class="vp-meta-item git-info"><div class="vp-meta-item last-updated"><span class="meta-item-label">Last Updated: </span><!----></div><div class="vp-meta-item contributors"><span class="meta-item-label">Contributors: </span><span class="meta-item-info"><!--[--><!--[--><span class="contributor" title="email: ktelep@gmail.com">Kurt Telep</span><!----><!--]--><!--]--></span></div></div></footer><nav class="vp-page-nav" aria-label="page navigation"><a class="route-link auto-link prev" href="/ansible_terra_ntnx_101/Configuration.html" aria-label="Configuration"><div class="hint"><span class="arrow left"></span> Prev</div><div class="link"><span>Configuration</span></div></a><a class="route-link auto-link next" href="/ansible_terra_ntnx_101/Ansible.html" aria-label="Ansible"><div class="hint">Next <span class="arrow right"></span></div><div class="link"><span>Ansible</span></div></a></nav><!--[--><!--]--></main><!--]--></div><!--[--><!----><!--]--><!--]--></div>
    <script type="module" src="/assets/app-6qZbiVGh.js" defer></script>
  </body>
</html>
