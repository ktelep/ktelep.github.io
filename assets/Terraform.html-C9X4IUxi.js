import{_ as a,c as t,f as r,o as i}from"./app-6qZbiVGh.js";const s="/images/auto_terra_1.png",n="/images/auto_terra_3.png",o="/images/auto_terra_2.png",l="/images/auto_terra_4.png",m="/images/auto_terra_5.png",d="/images/auto_terra_6.png",p="/images/auto_terra_7.png",c="/images/auto_terra_8.png",h="/images/auto_terra_9.png",g="/images/auto_terra_10.png",u="/images/auto_terra_11.png",f="/images/auto_terra_12.png",v="/images/auto_terra_13.png",_="/images/auto_terra_14.png",b="/images/auto_terra_15.png",y="/images/auto_terra_16.png",w={};function P(M,e){return i(),t("div",null,e[0]||(e[0]=[r('<h1 id="terraform" tabindex="-1"><a class="header-anchor" href="#terraform"><span>Terraform</span></a></h1><h2 id="terraform-overview" tabindex="-1"><a class="header-anchor" href="#terraform-overview"><span>Terraform Overview</span></a></h2><p>In this section, we will use terraform to create a VM, make some modifications to that VM and then destroy that VM. Please be sure to follow along closely as we make changes. Note this is NOT a demonstration or deep dive into Terraform, but an overview showing how easy it is to integrate Terraform with Nutanix AHV.</p><h2 id="create-a-vm" tabindex="-1"><a class="header-anchor" href="#create-a-vm"><span>Create a VM</span></a></h2><ol><li><p>In your Admin VM, select the autolab/lab/terraform directory. This directory contains 3 files that make up our terraform configuration. main.tf is where the configuration steps are enumerated, terraform.tfvars stores our variables and variables.tf defines our variables.</p><p><img src="'+s+`" alt="Login Page"></p></li><li><p>In your Terminal cd into the autolab/lab/terraform directory and initialize the terraform configuration. This will automatically download the appropriate modules.</p></li></ol><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre><code><span class="line"><span class="token builtin class-name">cd</span> ~/autolab/lab/ansible </span>
<span class="line">terraform init</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><p><img src="`+n+'" alt="Login Page"></p><ol start="3"><li><p>Update the terraform.tfvars file, providing the PC IP address, username, and password, saving the file. Be sure to retain the double quotes around all values. There are much more secure ways of storing these secrets but for the sake of our lab we&#39;ve taken some shortcuts.</p><p><img src="'+o+'" alt="Login Page"></p></li><li><p>Update the main.tf file, scrolling down until you find the VM name definition shown below. Update this to reflect YOUR user number.</p><p><img src="'+l+`" alt="Login Page"></p></li><li><p>In the terminal, validate the terraform configuration. This will confirm that the config is syntactically valid, but may not catch all errors.</p></li></ol><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre><code><span class="line">terraform validate</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p><img src="`+m+`" alt="Login Page"></p><ol start="6"><li>Now lets see what will happen when we run this Terraform configuration. You will see that many items in the plan are generated AFTER the VM is created, this is expected and Terraform maintains these items to make configuration changes in the future easier.</li></ol><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre><code><span class="line">terraform plan</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p><img src="`+d+`" alt="Login Page"></p><ol start="7"><li>Finally lets apply the Terraform configuration to the cluster and create the VM.</li></ol><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre><code><span class="line">terraform apply</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p><img src="`+p+'" alt="Login Page"></p><p><img src="'+c+'" alt="Login Page"></p><p><img src="'+h+'" alt="Login Page"></p><p>After the plan is shown to you again, you will be prompted to type &quot;yes&quot; to apply this plan. Go ahead and enter &quot;yes&quot; and hit enter. You can now confirm in Prism Central that your VM has been created.</p><p><img src="'+g+'" alt="Login Page"></p><p>Note the number of vCPUs and Memory that are currently configured for the VM (2 vCPU, 1GB Memory)</p><h2 id="modify-a-vm" tabindex="-1"><a class="header-anchor" href="#modify-a-vm"><span>Modify a VM</span></a></h2><ol><li><p>Back in your admin VM, locate the num_vcpus_per_socket and memory_size_mib parameters in the main.tf file. Update them to reflect 4 vCPUs per socket and 2048 mib or memory as shown below. Be sure to save the file after making this change.</p><p><img src="'+u+`" alt="Login Page"></p></li><li><p>Check what the terraform plan says will happen based on the configuration change we just made. Note how it is only modifying the VM&#39;s configuration, not deleting or rebuilding it.</p></li></ol><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre><code><span class="line">terraform plan</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p><img src="`+f+`" alt="Login Page"></p><ol start="3"><li>Lets apply the Terraform configuration to the cluster and modify the VM. This may take a few seconds to apply.</li></ol><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre><code><span class="line">terraform apply</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p><img src="`+v+'" alt="Login Page"></p><ol start="4"><li><p>Finally, go back and check the CPU and memory configuration as seen in Prism Central. Note how it now has 4 vCPU and 2GB of memory attached.</p><p><img src="'+_+`" alt="Login Page"></p></li></ol><h2 id="removing-the-vm" tabindex="-1"><a class="header-anchor" href="#removing-the-vm"><span>Removing the VM</span></a></h2><p>Now that we&#39;re finished with our virtual machine, we can use terraform to remove it also.</p><ol><li>Execute the destroy command in the terminal to reclaim the VM and it&#39;s resources.</li></ol><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre><code><span class="line">terraform destroy</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p><img src="`+b+'" alt="Login Page"></p><p><img src="'+y+'" alt="Login Page"></p><ol start="2"><li>Confirm in Prism Central that the VM is no longer deployed.</li></ol>',36)]))}const k=a(w,[["render",P],["__file","Terraform.html.vue"]]),V=JSON.parse('{"path":"/ansible_terra_ntnx_101/Terraform.html","title":"Terraform","lang":"en-US","frontmatter":{},"headers":[{"level":2,"title":"Terraform Overview","slug":"terraform-overview","link":"#terraform-overview","children":[]},{"level":2,"title":"Create a VM","slug":"create-a-vm","link":"#create-a-vm","children":[]},{"level":2,"title":"Modify a VM","slug":"modify-a-vm","link":"#modify-a-vm","children":[]},{"level":2,"title":"Removing the VM","slug":"removing-the-vm","link":"#removing-the-vm","children":[]}],"git":{"updatedTime":1749141109000,"contributors":[{"name":"Kurt Telep","email":"ktelep@gmail.com","commits":1}]},"filePathRelative":"ansible_terra_ntnx_101/Terraform.md"}');export{k as comp,V as data};
